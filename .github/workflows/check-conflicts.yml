name: Check for Merge Conflicts

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  conflict-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check for merge conflict markers
        run: |
          # Only match actual conflict markers (7+ chars at start of line), excluding docs that mention them
          FOUND=0
          if grep -rn "^<<<<<<<" . --exclude-dir=.git --exclude-dir=node_modules --include="*.js" --include="*.ts" --include="*.json" --include="*.css" --include="*.html" --include="*.yml" --include="*.yaml" --include="*.md"; then
            FOUND=1
          fi
          if grep -rn "^=======$" . --exclude-dir=.git --exclude-dir=node_modules --include="*.js" --include="*.ts" --include="*.json" --include="*.css" --include="*.html" --include="*.yml" --include="*.yaml" --include="*.md"; then
            FOUND=1
          fi
          if grep -rn "^>>>>>>>" . --exclude-dir=.git --exclude-dir=node_modules --include="*.js" --include="*.ts" --include="*.json" --include="*.css" --include="*.html" --include="*.yml" --include="*.yaml" --include="*.md"; then
            FOUND=1
          fi
          if [ "$FOUND" -eq 1 ]; then
            echo "❌ Merge conflict markers found! Please resolve conflicts before merging."
            exit 1
          fi
          echo "✅ No merge conflict markers detected."