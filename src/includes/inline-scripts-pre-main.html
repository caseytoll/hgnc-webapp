  <script>

  // Admin controls wiring: calls server helpers via google.script.run
  document.addEventListener('DOMContentLoaded', function() {
    try {
        if (!window.google || !google.script || !google.script.run) return;
        var adminToggle = document.getElementById('admin-toggle-test-insights');
        var adminOwnerInput = document.getElementById('admin-owner-email');
        var adminSetOwnerBtn = document.getElementById('admin-set-owner-btn');
        var adminFeatureStatus = document.getElementById('admin-feature-status');

        // Initialize from server
        google.script.run.withSuccessHandler(function(settings){
            try {
                if (adminToggle) adminToggle.checked = !!settings.testInsightsEnabled;
                if (adminOwnerInput) adminOwnerInput.value = settings.ownerEmail || '';
                if (adminFeatureStatus) adminFeatureStatus.textContent = settings.testInsightsEnabled ? 'Enabled' : 'Disabled';
            } catch (e) { console.warn('admin init populate error', e); }
        }).getAdminSettings();

        if (adminToggle) {
            adminToggle.addEventListener('change', function() {
                var enabled = !!adminToggle.checked;
                google.script.run.withSuccessHandler(function(){
                    if (adminFeatureStatus) adminFeatureStatus.textContent = enabled ? 'Enabled' : 'Disabled';
                    if (typeof showToast === 'function') showToast('Test Insights ' + (enabled ? 'enabled' : 'disabled'));
                }).setTestInsightsEnabled(enabled);
            });
        }

        if (adminSetOwnerBtn) {
            adminSetOwnerBtn.addEventListener('click', function() {
                var newEmail = adminOwnerInput ? adminOwnerInput.value : '';
                google.script.run.withSuccessHandler(function(){
                    if (typeof showToast === 'function') showToast('Owner email updated');
                }).setOwnerEmail(String(newEmail || ''));
            });
        }

    } catch (e) { console.warn('Admin UI wiring failed', e); }
  });
  </script>
  <nav class="bottom-nav hidden" id="app-tab-nav">
    <button id="show-home-tab" class="bottom-nav-button app-nav"
    onclick="showTeamSelector()">
    <span class="nav-label">Teams</span></button>
    <button id="show-fixture-tab"
    class="bottom-nav-button app-nav active" onclick=
    "showView('fixture-view')">
    <span class="nav-label">Schedule</span></button>
    <button id="show-players-tab" class="bottom-nav-button app-nav"
    onclick="showView('players-view')">
    <span class="nav-label">Players</span></button>
    <button id="show-netball-ladder-tab" class="bottom-nav-button app-nav"
    onclick="showView('netball-ladder-view')">
    <span class="nav-label">Ladder</span></button>
    <button id="show-insights-tab"
    class="bottom-nav-button app-nav insights-tab-btn" onclick=
    "showView('insights-view')">
    <span class="nav-label">Stats</span></button>
  </nav>
  <nav class="bottom-nav hidden" id="game-detail-tab-nav">
    <button id="show-home-tab-game" class=
    "bottom-nav-button game-nav" onclick=
    "showTeamSelector()">
    <span class="nav-label">Back</span></button>
    <button id="show-availability-tab"
    class="bottom-nav-button game-nav active" onclick=
    "showGameDetailTab('availability')">
    <span class="nav-label">Availability</span></button>
    <button id="show-lineup-tab"
    class="bottom-nav-button game-nav" onclick=
    "showGameDetailTab('lineup')">
    <span class="nav-label">Lineup</span></button>
    <button id="show-scoring-tab"
    class="bottom-nav-button game-nav" onclick=
    "showGameDetailTab('scoring')">
    <span class="nav-label">Score</span></button>
    <button id="show-edit-tab"
    class="bottom-nav-button game-nav hidden" onclick=
    "showGameDetailTab('edit')">
    <span class="nav-label">Edit</span></button>
  </nav>
  <!-- Read-Only Mode Indicator for Parents/Non-Owners -->
  <div id="read-only-banner" class="read-only-banner hidden">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
    <span>Read-Only Mode: You can view all stats but cannot make changes</span>
  </div>
  <main id="main-content">
    <div id="team-selector-view" class="view">
      <section class="card team-selector-card">
        <div class="card-header team-selector-header">
          <h2 class="card-title">Select a Team</h2>
          <div class="team-header-actions">
            <button id="toggle-edit-mode" class="btn-edit-teams hidden" onclick="toggleTeamEditMode()" aria-label="Edit Teams">Edit</button>
            <button id="show-add-team-modal" class="btn-create-team hidden" aria-label="Create New Team">‚ûï</button>
          </div>
        </div>
        <div id="team-list-container" class="team-list-modern"></div>
      </section>
    </div>
    <div id="players-view" class="view hidden">
      <section class="card">
        <div class="card-header">
          <h2 class="card-title">Player List</h2><button id=
          "show-add-player-modal" class=
          "icon-btn hidden">‚ûï</button>
        </div>
        <div id="player-list"></div>
      </section>
    </div>
    <div id="fixture-view" class="view hidden">
      <section class="card">
        <div class="card-header">
          <h2 class="card-title">Games</h2><button id=
          "show-add-game-modal" class="icon-btn hidden">‚ûï</button>
        </div>
        <div id="game-list"></div>
      </section>
    </div>
    <div id="insights-offense-hub-view" class="view hidden">
      <button class="back-button" onclick="showView('insights-view')">‚Üê Back to Insights</button>
      <button class="back-button" onclick="showTeamSelector()" style="margin-left: 10px;">üè† Home</button>
      <section class="card">
        <div class="card-header">
          <h2 class="card-title">Team Manager</h2>
        </div>
        <div class="hub-tabs" role="tablist" aria-label="Offensive leaderboards" style="display:flex;gap:8px;margin:10px 0;">
          <button id="offense-hub-tab-singles" class="hub-tab" role="tab" tabindex="0" aria-selected="false" onclick="setOffenseHubTab('singles')">Singles</button>
          <button id="offense-hub-tab-pairs" class="hub-tab" role="tab" tabindex="0" aria-selected="false" onclick="setOffenseHubTab('pairs')">Pairs</button>
          <!-- Show Top 3 / Show All toggle (per-tab) -->
          <button id="offense-show-all-toggle" class="hub-tab" aria-pressed="false" title="Toggle show all results" style="margin-left:auto;">Show Top 3</button>
        </div>

        <div id="offense-tab-singles" style="display:block;">
          <div class="card-subsection">
            <h3 class="card-subtitle">Single Player Leaders</h3>
            <div class="sort-tabs">
              <button id="sort-single-impact" class="sort-tab-button active" onclick="setInsightsSort('single', 'impact')">Total Impact</button>
              <button id="sort-single-avg" class="sort-tab-button" onclick="setInsightsSort('single', 'avg')">Efficiency (Avg)</button>
              <button id="sort-single-qtrs" class="sort-tab-button" onclick="setInsightsSort('single', 'quarters')">Qtrs</button>
            </div>
            <div id="leaderboard-list-total"></div>
            <div id="leaderboard-list-per-qtr" style="margin-top:8px;"></div>
          </div>
        </div>

        <div id="offense-tab-pairs" style="display:none;">
          <div class="card-subsection">
            <h3 class="card-subtitle">GS/GA Pairs (Goals Scored)</h3>
            <p class="card-subtitle hidden" id="insights-offense-subtitle">Note: "Efficiency" sort only shows pairs with 3 or more Qtrs played.</p>
            <div class="sort-tabs">
              <button id="sort-offense-impact" class="sort-tab-button active" onclick="setInsightsSort('offense', 'impact')">Total Impact</button>
              <button id="sort-offense-avg" class="sort-tab-button" onclick="setInsightsSort('offense', 'avg')">Efficiency (Avg)</button>
              <button id="sort-offense-qtrs" class="sort-tab-button" onclick="setInsightsSort('offense', 'quarters')">Qtrs</button>
            </div>
            <div id="insights-offense-combos"></div>
          </div>
        </div>
      </section>
    </div>
    <div id="player-goals-detail-view" class="view hidden">
      <button class="back-button" onclick="showView('insights-offense-hub-view')">‚Üê Back to Offensive Hub</button>
      <button class="back-button" onclick="showTeamSelector()" style="margin-left: 10px;">üè† Home</button>
      <section class="card">
        <h2 class="card-title" id="player-goals-detail-title">Player Goal Details</h2>
        <div id="player-goals-detail-content"></div>
      </section>
    </div>
    <div id="pair-goals-detail-view" class="view hidden">
      <button class="back-button" onclick="showView('insights-offense-hub-view')">‚Üê Back to Offensive Hub</button>
      <button class="back-button" onclick="showTeamSelector()" style="margin-left: 10px;">üè† Home</button>
      <section class="card">
        <h2 class="card-title" id="pair-goals-detail-title">Pair Goal Details</h2>
        <div id="pair-goals-detail-content"></div>
      </section>
    </div>
    <!-- NEW INSIGHTS DASHBOARD -->
    <div id="insights-view" class="view hidden">
