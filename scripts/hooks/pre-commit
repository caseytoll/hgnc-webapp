#!/usr/bin/env bash
set -euo pipefail
# Pre-commit hook to detect and archive large HTML backups before committing
# NOTE: To install locally, symlink this file into .git/hooks/pre-commit

REPO_ROOT="$(cd "$(dirname "$0")/../.." && pwd)"
HOOK_SCRIPT="$REPO_ROOT/scripts/zip-archives.sh"

echo "Running pre-commit archive checks..."
if [ -x "$HOOK_SCRIPT" ]; then
  # Run in non-commit mode (zip but don't commit) first
  "$HOOK_SCRIPT"
fi

# Run pre-deploy validation checks; block commit if critical checks fail
PRE_DEPLOY_CHECK="$REPO_ROOT/scripts/pre-deploy-check.sh"
if [ -x "$PRE_DEPLOY_CHECK" ]; then
  echo "Running pre-deploy checks (this will block commit on failures)..."
  "$PRE_DEPLOY_CHECK"
  if [ $? -ne 0 ]; then
    echo "Pre-deploy checks failed. Commit aborted." >&2
    exit 1
  fi
fi

exit 0
